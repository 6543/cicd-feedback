{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CI/CD Feedback Standard - Feedback Response",
  "oneOf": [
    {
      "$ref": "#/definitions/pipelineResponse"
    },
    {
      "$ref": "#/definitions/errorResponse"
    }
  ],
  "definitions": {
    "errorResponse": {
      "type": "object",
      "properties": {
        "error": {
          "$ref": "#/definitions/errorType"
        },
        "errorDescription": {
          "type": "string",
          "description": "Detailed description of the error"
        }
      },
      "required": ["error"],
      "additionalProperties": false
    },
    "errorType": {
      "type": "string",
      "enum": [
        "internal",
        "config",
        "external",
        "permission",
        "validation",
        "other"
      ],
      "description": "Type of error encountered",
      "enumDescriptions": {
        "internal": "CI/CD engine encountered an unexpected internal error",
        "config": "Error in the pipeline configuration or workflow definition",
        "external": "Error in an external service that the CI/CD engine depends on",
        "permission": "Insufficient permissions to perform the requested action",
        "validation": "Input validation errors",
        "other": "All other unspecified errors"
      }
    },
    "pipelineResponse": {
      "type": "object",
      "properties": {
        "pipelineId": {
          "type": "string",
          "description": "Unique identifier for the pipeline"
        },
        "title": {
          "type": "string",
          "description": "Title tho display for a pipeline"
        },
        "status": {
          "$ref": "#/definitions/status"
        },
        "requiresManualAction": {
          "type": "boolean",
          "description": "Indicates if manual action is required"
        },
        "workflows": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/workflow"
          },
          "description": "Array of workflows in the pipeline"
        },
        "externalURI": {
          "type": "string",
          "description": "Link to CI/CD engine native interface"
        }
      },
      "required": ["pipelineId", "status", "workflows"]
    },
    "status": {
      "type": "string",
      "enum": [
        "skipped",
        "pending",
        "running",
        "success",
        "failed",
        "killed",
        "manual",
        "declined"
      ],
      "description": "Current status"
    },
    "outputs": {
      "type": "object",
      "properties": {
        "logs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/log"
          },
          "description": "List of logs generated by the pipeline or step"
        },
        "artifacts": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/artifact"
          },
          "description": "List of artifacts generated by the pipeline or step"
        }
      }
    },
    "workflow": {
      "type": "object",
      "oneOf": [
        {
          "properties": {
            "id": {
              "type": "string",
              "description": "Unique identifier for the workflow"
            },
            "name": {
              "type": "string",
              "description": "Optional name for the workflow"
            },
            "status": {
              "$ref": "#/definitions/status"
            },
            "dependencies": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "IDs of workflows that this workflow depends on"
            },
            "steps": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/step"
              },
              "description": "Array of steps in the workflow"
            }
          },
          "required": ["id", "status", "steps"]
        },
        {
          "properties": {
            "id": {
              "type": "string",
              "description": "Unique identifier for the workflow"
            },
            "name": {
              "type": "string",
              "description": "Optional name for the workflow"
            },
            "status": {
              "$ref": "#/definitions/status"
            },
            "dependencies": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "IDs of workflows that this workflow depends on"
            },
            "subWorkflows": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/workflow"
              },
              "description": "Array of nested workflows"
            }
          },
          "required": ["id", "status", "subWorkflows"]
        }
      ]
    },
    "step": {
      "type": "object",
      "required": ["id"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the step"
        },
        "name": {
          "type": "string",
          "description": "Optional name for the step"
        },
        "status": {
          "$ref": "#/definitions/status"
        },
        "inputs": {
          "$ref": "#/definitions/inputs"
        },
        "outputs": {
          "$ref": "#/definitions/outputs"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "IDs of steps that this step depends on"
        }
      }
    },
    "inputs": {
      "type": "object",
      "properties": {
        "commands": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Commands to be executed in this step"
        },
        "environment": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Environment variables for this step"
        }
      }
    },
    "artifact": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the artifact"
        },
        "uri": {
          "type": "string",
          "format": "uri",
          "description": "URI to download the artifact"
        },
        "mimeType": {
          "type": "string",
          "description": "MIME type of the artifact"
        }
      },
      "required": ["name", "uri", "mimeType"]
    },
    "log": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the log"
        },
        "uri": {
          "type": "string",
          "format": "uri",
          "description": ""description": "URI to access the log, the content is either an plain text of an ongoing stream of plain test"
        }
      },
      "required": ["name", "uri"]
    }
  }
}
